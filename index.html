<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Real Estate Platform</h1>

        <!-- Login Form -->
        <div id="login-form" class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Login</h5>
                <form id="login">
                    <div class="mb-3">
                        <label for="login-username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="login-username" placeholder="Enter your username" required>
                    </div>
                    <div class="mb-3">
                        <label for="login-password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="login-password" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
            </div>
        </div>

        <!-- Signup Form -->
        <div id="signup-form" class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Signup</h5>
                <form id="signup">
                    <div class="mb-3">
                        <label for="signup-username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="signup-username" placeholder="Choose a username" required>
                    </div>
                    <div class="mb-3">
                        <label for="signup-password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="signup-password" placeholder="Choose a password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Signup</button>
                </form>
            </div>
        </div>

        <!-- Search and Filter Form -->
        <div class="card mb-4">
            <div class="card-body">
                <form id="filter-form">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <input type="text" id="search-location" class="form-control" placeholder="Search by location">
                        </div>
                        <div class="col-md-3">
                            <select id="filter-type" class="form-select">
                                <option value="">All Types</option>
                                <option value="Apartment">Apartment</option>
                                <option value="Villa">Villa</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <input type="number" id="min-price" class="form-control" placeholder="Min Price">
                        </div>
                        <div class="col-md-2">
                            <input type="number" id="max-price" class="form-control" placeholder="Max Price">
                        </div>
                        <div class="col-md-1">
                            <button type="submit" class="btn btn-primary w-100">Search</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Form to Add a New Property -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Add a New Property</h5>
                <form id="property-form">
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="title" placeholder="e.g., Luxury Villa in Vlore" required>
                    </div>
                    <div class="mb-3">
                        <label for="price" class="form-label">Price (€)</label>
                        <input type="number" class="form-control" id="price" placeholder="e.g., 1000" required>
                    </div>
                    <div class="mb-3">
                        <label for="location" class="form-label">Location</label>
                        <input type="text" class="form-control" id="location" placeholder="e.g., Vlore" required>
                    </div>
                    <div class="mb-3">
                        <label for="type" class="form-label">Type</label>
                        <input type="text" class="form-control" id="type" placeholder="e.g., Villa" required>
                    </div>
                    <div class="mb-3">
                        <label for="bedrooms" class="form-label">Bedrooms</label>
                        <input type="number" class="form-control" id="bedrooms" placeholder="e.g., 5" required>
                    </div>
                    <div class="mb-3">
                        <label for="size" class="form-label">Size (m²)</label>
                        <input type="number" class="form-control" id="size" placeholder="e.g., 200" required>
                    </div>
                    <div class="mb-3">
                        <label for="image" class="form-label">Upload Image</label>
                        <input type="file" class="form-control" id="image" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Property</button>
                </form>
            </div>
        </div>

        <!-- Container for the property cards -->
        <div id="property-list" class="row">
            <!-- Cards will be dynamically added here -->
        </div>
    </div>

    <script>
        const backendUrl = 'https://real-estate-backend-wnlh.onrender.com';

        // Fetch and display properties
        function fetchProperties() {
            const location = document.getElementById('search-location').value;
            const type = document.getElementById('filter-type').value;
            const minPrice = document.getElementById('min-price').value;
            const maxPrice = document.getElementById('max-price').value;

            let query = '?';
            if (location) query += `location=${location}&`;
            if (type) query += `type=${type}&`;
            if (minPrice) query += `min_price=${minPrice}&`;
            if (maxPrice) query += `max_price=${maxPrice}&`;

            fetch(`${backendUrl}/properties${query}`)
                .then(response => response.json())
                .then(data => {
                    const propertyList = document.getElementById('property-list');
                    propertyList.innerHTML = '';
                    data.forEach(property => {
                        propertyList.innerHTML += `
                            <div class="col-md-4 mb-4">
                                <div class="card shadow-sm">
                                    <img src="${property.image_url || 'https://via.placeholder.com/300'}" class="card-img-top">
                                    <div class="card-body">
                                        <h5 class="card-title">${property.title}</h5>
                                        <p>
                                            <strong>Price:</strong> €${property.price}<br>
                                            <strong>Location:</strong> ${property.location}<br>
                                            <strong>Type:</strong> ${property.type}<br>
                                            <strong>Bedrooms:</strong> ${property.bedrooms}<br>
                                            <strong>Size:</strong> ${property.size} m²
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                })
                .catch(error => console.error(error));
        }

        // Add property with image upload
        document.getElementById('property-form').addEventListener('submit', function (event) {
            event.preventDefault();

            const formData = new FormData();
            formData.append('title', document.getElementById('title').value);
            formData.append('price', document.getElementById('price').value);
            formData.append('location', document.getElementById('location').value);
            formData.append('type', document.getElementById('type').value);
            formData.append('bedrooms', document.getElementById('bedrooms').value);
            formData.append('size', document.getElementById('size').value);
            formData.append('image', document.getElementById('image').files[0]);

            fetch(`${backendUrl}/properties`, {
                method: 'POST',
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('access_token')}`
                },
                body: formData,
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to add property');
                    }
                    return response.json();
                })
                .then(data => {
                    alert('Property added successfully!');
                    fetchProperties(); // Refresh the property list
                })
                .catch(error => {
                    alert('Error: ' + error.message);
                });
        });

        // Fetch properties initially
        fetchProperties();
    </script>
</body>
</html>
