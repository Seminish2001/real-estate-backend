<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Real Estate Platform</h1>

        <!-- Navigation -->
        <nav class="mb-4">
            <a href="/" class="btn btn-secondary">Home</a>
            <a href="/login" class="btn btn-primary">Login</a>
            <a href="/signup" class="btn btn-info">Signup</a>
            <a href="/add-property" class="btn btn-success">Add Property</a>
        </nav>

        <!-- Search and Filter Form -->
        <div class="card mb-4">
            <div class="card-body">
                <form id="filter-form">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <input type="text" id="search-location" class="form-control" placeholder="Search by location">
                        </div>
                        <div class="col-md-3">
                            <select id="filter-type" class="form-select">
                                <option value="">All Types</option>
                                <option value="Apartment">Apartment</option>
                                <option value="Villa">Villa</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <input type="number" id="min-price" class="form-control" placeholder="Min Price">
                        </div>
                        <div class="col-md-2">
                            <input type="number" id="max-price" class="form-control" placeholder="Max Price">
                        </div>
                        <div class="col-md-1">
                            <button type="submit" class="btn btn-primary w-100">Search</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Container for the property cards -->
        <div id="property-list" class="row">
            <!-- Cards will be dynamically added here -->
        </div>
    </div>

    <script>
        const backendUrl = 'https://real-estate-backend-wnlh.onrender.com';

        // Fetch and display properties
        function fetchProperties() {
            const location = document.getElementById('search-location').value;
            const type = document.getElementById('filter-type').value;
            const minPrice = document.getElementById('min-price').value;
            const maxPrice = document.getElementById('max-price').value;

            let query = '?';
            if (location) query += `location=${location}&`;
            if (type) query += `type=${type}&`;
            if (minPrice) query += `min_price=${minPrice}&`;
            if (maxPrice) query += `max_price=${maxPrice}&`;

            fetch(`${backendUrl}/properties${query}`)
                .then(response => response.json())
                .then(data => {
                    const propertyList = document.getElementById('property-list');
                    propertyList.innerHTML = '';
                    data.forEach(property => {
                        propertyList.innerHTML += `
                            <div class="col-md-4 mb-4">
                                <div class="card shadow-sm">
                                    <img src="${property.image_url || 'https://via.placeholder.com/300'}" class="card-img-top">
                                    <div class="card-body">
                                        <h5 class="card-title">${property.title}</h5>
                                        <p>
                                            <strong>Price:</strong> €${property.price}<br>
                                            <strong>Location:</strong> ${property.location}<br>
                                            <strong>Type:</strong> ${property.type}<br>
                                            <strong>Bedrooms:</strong> ${property.bedrooms}<br>
                                            <strong>Size:</strong> ${property.size} m²
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                })
                .catch(error => console.error(error));
        }

        // Fetch properties initially
        fetchProperties();
    </script>
</body>
</html>
