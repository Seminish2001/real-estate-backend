<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Property Listings</h1>

        <!-- Search and Filter Form -->
        <div class="card mb-4">
            <div class="card-body">
                <form id="filter-form">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <input type="text" id="search-location" class="form-control" placeholder="Search by location">
                        </div>
                        <div class="col-md-3">
                            <select id="filter-type" class="form-select">
                                <option value="">All Types</option>
                                <option value="Apartment">Apartment</option>
                                <option value="Villa">Villa</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <input type="number" id="min-price" class="form-control" placeholder="Min Price">
                        </div>
                        <div class="col-md-2">
                            <input type="number" id="max-price" class="form-control" placeholder="Max Price">
                        </div>
                        <div class="col-md-1">
                            <button type="submit" class="btn btn-primary w-100">Search</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Form to Add a New Property -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Add a New Property</h5>
                <form id="property-form">
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="title" placeholder="e.g., Luxury Villa in Vlore" required>
                    </div>
                    <div class="mb-3">
                        <label for="price" class="form-label">Price (€)</label>
                        <input type="number" class="form-control" id="price" placeholder="e.g., 1000" required>
                    </div>
                    <div class="mb-3">
                        <label for="location" class="form-label">Location</label>
                        <input type="text" class="form-control" id="location" placeholder="e.g., Vlore" required>
                    </div>
                    <div class="mb-3">
                        <label for="type" class="form-label">Type</label>
                        <input type="text" class="form-control" id="type" placeholder="e.g., Villa" required>
                    </div>
                    <div class="mb-3">
                        <label for="bedrooms" class="form-label">Bedrooms</label>
                        <input type="number" class="form-control" id="bedrooms" placeholder="e.g., 5" required>
                    </div>
                    <div class="mb-3">
                        <label for="size" class="form-label">Size (m²)</label>
                        <input type="number" class="form-control" id="size" placeholder="e.g., 200" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Property</button>
                </form>
            </div>
        </div>

        <!-- Container for the property cards -->
        <div id="property-list" class="row">
            <!-- Cards will be dynamically added here -->
        </div>
    </div>

    <script>
        const backendUrl = 'https://real-estate-backend-wnlh.onrender.com/properties';

        // Fetch properties and display them as cards
        function fetchProperties() {
            const location = document.getElementById('search-location').value;
            const type = document.getElementById('filter-type').value;
            const minPrice = document.getElementById('min-price').value;
            const maxPrice = document.getElementById('max-price').value;

            // Build query parameters
            let query = '?';
            if (location) query += `location=${location}&`;
            if (type) query += `type=${type}&`;
            if (minPrice) query += `min_price=${minPrice}&`;
            if (maxPrice) query += `max_price=${maxPrice}&`;

            fetch(`${backendUrl}${query}`)
                .then(response => response.json())
                .then(data => {
                    const propertyList = document.getElementById('property-list');
                    propertyList.innerHTML = ''; // Clear the list
                    data.forEach(property => {
                        const propertyCard = `
                            <div class="col-md-4 mb-4">
                                <div class="card shadow-sm">
                                    <div class="card-body">
                                        <h5 class="card-title">${property.title}</h5>
                                        <p class="card-text">
                                            <strong>Price:</strong> €${property.price}<br>
                                            <strong>Location:</strong> ${property.location}<br>
                                            <strong>Type:</strong> ${property.type}<br>
                                            <strong>Bedrooms:</strong> ${property.bedrooms}<br>
                                            <strong>Size:</strong> ${property.size} m²
                                        </p>
                                        <button class="btn btn-danger btn-sm" onclick="deleteProperty(${property.id})">Delete</button>
                                        <button class="btn btn-warning btn-sm" onclick="editProperty(${property.id})">Edit</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        propertyList.innerHTML += propertyCard;
                    });
                })
                .catch(error => {
                    console.error('Error fetching properties:', error);
                });
        }

        // Add Property Form Submission
        document.getElementById('property-form').addEventListener('submit', function (event) {
            event.preventDefault();

            const title = document.getElementById('title').value;
            const price = parseFloat(document.getElementById('price').value);
            const location = document.getElementById('location').value;
            const type = document.getElementById('type').value;
            const bedrooms = parseInt(document.getElementById('bedrooms').value, 10);
            const size = parseFloat(document.getElementById('size').value);

            fetch(backendUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ title, price, location, type, bedrooms, size }),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to add property');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Property added successfully:', data);
                    fetchProperties(); // Refresh the property list
                })
                .catch(error => {
                    console.error('Error adding property:', error);
                });
        });

        // Filter Form Submission
        document.getElementById('filter-form').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent page reload
            fetchProperties(); // Fetch properties with the applied filters
        });

        // Function to delete a property
        function deleteProperty(id) {
            if (confirm('Are you sure you want to delete this property?')) {
                fetch(`${backendUrl}/${id}`, {
                    method: 'DELETE',
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to delete property');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log(data.message);
                        fetchProperties(); // Refresh the property list
                    })
                    .catch(error => {
                        console.error('Error deleting property:', error);
                    });
            }
        }

        // Function to edit a property
        function editProperty(id) {
            const title = prompt('Enter new title:');
            const price = parseFloat(prompt('Enter new price:'));
            const location = prompt('Enter new location:');
            const type = prompt('Enter new type:');
            const bedrooms = parseInt(prompt('Enter new number of bedrooms:'), 10);
            const size = parseFloat(prompt('Enter new size in m²:'));

            fetch(`${backendUrl}/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ title, price, location, type, bedrooms, size }),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to update property');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(data.message);
                    fetchProperties(); // Refresh the property list
                })
                .catch(error => {
                    console.error('Error updating property:', error);
                });
        }

        // Initial fetch to display properties
        fetchProperties();
    </script>
</body>
</html>
