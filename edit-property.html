<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Property</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Edit Property</h1>

        <!-- Form to Edit Property -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Edit Property</h5>
                <form id="edit-property-form">
                    <input type="hidden" id="property-id"> <!-- Hidden input for Property ID -->
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="title" placeholder="e.g., Luxury Villa in Vlore" required>
                    </div>
                    <div class="mb-3">
                        <label for="price" class="form-label">Price (€)</label>
                        <input type="number" class="form-control" id="price" placeholder="e.g., 1000" required>
                    </div>
                    <div class="mb-3">
                        <label for="location" class="form-label">Location</label>
                        <input type="text" class="form-control" id="location" placeholder="e.g., Vlore" required>
                    </div>
                    <div class="mb-3">
                        <label for="type" class="form-label">Type</label>
                        <input type="text" class="form-control" id="type" placeholder="e.g., Villa" required>
                    </div>
                    <div class="mb-3">
                        <label for="bedrooms" class="form-label">Bedrooms</label>
                        <input type="number" class="form-control" id="bedrooms" placeholder="e.g., 5" required>
                    </div>
                    <div class="mb-3">
                        <label for="size" class="form-label">Size (m²)</label>
                        <input type="number" class="form-control" id="size" placeholder="e.g., 200" required>
                    </div>
                    <div class="mb-3">
                        <label for="image" class="form-label">Upload Image</label>
                        <input type="file" class="form-control" id="image">
                    </div>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const backendUrl = 'https://real-estate-backend-wnlh.onrender.com';
        const propertyId = new URLSearchParams(window.location.search).get('id'); // Get property ID from URL query

        // Fetch property details
        fetch(`${backendUrl}/properties/${propertyId}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('property-id').value = data.id;
                document.getElementById('title').value = data.title;
                document.getElementById('price').value = data.price;
                document.getElementById('location').value = data.location;
                document.getElementById('type').value = data.type;
                document.getElementById('bedrooms').value = data.bedrooms;
                document.getElementById('size').value = data.size;
            })
            .catch(error => alert('Failed to load property details'));

        // Handle Edit Property form submission
        document.getElementById('edit-property-form').addEventListener('submit', function (event) {
            event.preventDefault();

            const formData = new FormData();
            formData.append('title', document.getElementById('title').value);
            formData.append('price', document.getElementById('price').value);
            formData.append('location', document.getElementById('location').value);
            formData.append('type', document.getElementById('type').value);
            formData.append('bedrooms', document.getElementById('bedrooms').value);
            formData.append('size', document.getElementById('size').value);
            const imageFile = document.getElementById('image').files[0];
            if (imageFile) {
                formData.append('image', imageFile);
            }

            fetch(`${backendUrl}/properties/${propertyId}`, {
                method: 'PUT',
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('access_token')}`,
                },
                body: formData,
            })
                .then(response => {
                    if (!response.ok) throw new Error('Failed to update property');
                    return response.json();
                })
                .then(data => {
                    alert('Property updated successfully!');
                    window.location.href = '/dashboard'; // Redirect to dashboard
                })
                .catch(error => alert('Error: ' + error.message));
        });
    </script>
</body>
</html>
